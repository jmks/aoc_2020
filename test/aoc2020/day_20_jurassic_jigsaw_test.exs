defmodule Aoc2020.Day20JurassicJigsawTest do
  use ExUnit.Case, async: true

  import Aoc2020.Day20JurassicJigsaw

  @test """
  Tile 2311:
  ..##.#..#.
  ##..#.....
  #...##..#.
  ####.#...#
  ##.##.###.
  ##...#.###
  .#.#.#..##
  ..#....#..
  ###...#.#.
  ..###..###

  Tile 1951:
  #.##...##.
  #.####...#
  .....#..##
  #...######
  .##.#....#
  .###.#####
  ###.##.##.
  .###....#.
  ..#.#..#.#
  #...##.#..

  Tile 1171:
  ####...##.
  #..##.#..#
  ##.#..#.#.
  .###.####.
  ..###.####
  .##....##.
  .#...####.
  #.##.####.
  ####..#...
  .....##...

  Tile 1427:
  ###.##.#..
  .#..#.##..
  .#.##.#..#
  #.#.#.##.#
  ....#...##
  ...##..##.
  ...#.#####
  .#.####.#.
  ..#..###.#
  ..##.#..#.

  Tile 1489:
  ##.#.#....
  ..##...#..
  .##..##...
  ..#...#...
  #####...#.
  #..#.#.#.#
  ...#.#.#..
  ##.#...##.
  ..##.##.##
  ###.##.#..

  Tile 2473:
  #....####.
  #..#.##...
  #.##..#...
  ######.#.#
  .#...#.#.#
  .#########
  .###.#..#.
  ########.#
  ##...##.#.
  ..###.#.#.

  Tile 2971:
  ..#.#....#
  #...###...
  #.#.###...
  ##.##..#..
  .#####..##
  .#..####.#
  #..#.#..#.
  ..####.###
  ..#.#.###.
  ...#.#.#.#

  Tile 2729:
  ...#.#.#.#
  ####.#....
  ..#.#.....
  ....#..#.#
  .##..##.#.
  .#.####...
  ####.#.#..
  ##.####...
  ##..#.##..
  #.##...##.

  Tile 3079:
  #.#.#####.
  .#..######
  ..#.......
  ######....
  ####.#..#.
  .#...#.##.
  #.#####.##
  ..#.###...
  ..#.......
  ..#.###...
  """ |> String.split("\n")

  test "parsing" do
    assert parse_tile(hd(tilize(@test))) == %{
      id: "2311",
      sides: [
        "..##.#..#.",
        "..###..###",
        ".#####..#.",
        "...#.##..#"
      ]
    }
  end

 test "put tiles together" do
    assert edges([%{
          id: "2311",
          sides: [
            "..##.#..#.",
            "..###..###",
            ".#####..#.",
            "...#.##..#"
          ]}]) == %{
      "..##.#..#." => ["2311"],
      ".#..#.##.." => ["2311"],
      "..###..###" => ["2311"],
      "###..###.." => ["2311"],
      ".#####..#." => ["2311"],
      ".#..#####." => ["2311"],
      "...#.##..#" => ["2311"],
      "#..##.#..." => ["2311"]
      }
  end

 test "solve" do
   assert edges(@test |> tilize() |> Enum.map(&parse_tile/1)) |> product_of_corner_ids == 20899048083289
 end

 test "part 1" do
   result =
     Input.strings(20)
     |> tilize
     |> Enum.map(&parse_tile/1)
     |> edges
     |> product_of_corner_ids

   IO.puts("Part 1: #{result}")
   IO.puts("")
 end

  def tilize(lines) do
    lines
    |> Enum.chunk_by(&(String.length(&1) == 0))
    |> Enum.filter(fn
      [""] -> false
      ____ -> true
    end)
  end
end
